<!DOCTYPE html>
<html lang="en">
{% load static %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="{% static "img/favicon(sushi).png" %}" type="image/x-icon">
    <link rel="stylesheet" href="{% static "css/navfooter2.css" %}">
    <link rel="stylesheet" href="{% static "css/write.css" %}">
    
    <link href="
        https://cdn.jsdelivr.net/npm/reset-css@5.0.2/reset.min.css
        " rel="stylesheet">

    <title>Write</title>
</head>

<body>
    <header>
        <div class="NavBar">
            <div class="NavContainer">
                <a href="/"><img src="{% static 'img/logo(white).svg' %}"></a>
                <div class='nav-buttons'>
                    <a href='/post_list/일상'>일상</a>
                    <a href='/post_list/요리'>요리</a>
                    <a href='/post_list/여행'>여행</a>
                    <a href='/post_list/영화'>영화</a>
                    <a href='/post_list/IT'>IT</a>
                    {% if user.is_authenticated %}
                        <a href="/logout"><button class='logout-button'>Logout</button></a>
                        <a href="/posting"><button class='PrimaryButton'>Just Write!</button></a>
                    {% else %}
                        <a href="/login"><button class='PrimaryButton'>Login</button></a>
                    {% endif %}
                </div>
            </div>
        </div>
    </header>
    <main>
        <!-- 제목 부분 -->
        <div class="container">
            <div class='big-box'>
                <form method="POST" enctype="multipart/form-data">
                <div class='write-box'> 
                    {% csrf_token %}
                    {{form.media}}
                    {{form.as_p}}
                    <br>        
                </div>
                <div class="post-info-box">
                    <button type="button" id="aiAutocompleteButton" class="ai-button">
                      <img id="ai-img" src="{% static 'img/robot.svg' %}" alt="AI 아이콘" />
                      <div id="loading-animation" style="display: none;">
                        <img src="{% static 'img/loading.gif' %}" alt="로딩 중" />
                      </div> 
                      AI 글 자동완성
                    </button>
                               
                    <div class="box">
                      <h2>TOPIC</h2>
                      <div>
                        <input type="radio" id="all" name="topic" value="전체" checked='checked'>
                        <label for="all">전체</label>
                      </div>
                      <div>
                          <input type="radio" id="daily" name="topic" value="일상">
                          <label for="daily">일상</label>
                      </div>
                      <div>
                        <input type="radio" id="cooking" name="topic" value="요리">
                        <label for="cooking">요리</label>
                      </div>
                      <div>
                        <input type="radio" id="travel" name="topic" value="여행">
                        <label for="travel">여행</label>
                      </div>
                      <div>
                        <input type="radio" id="movie" name="topic" value="영화">
                        <label for="movie">영화</label>
                      </div>
                      <div>
                        <input type="radio" id="it" name="topic" value="IT">
                        <label for="it">IT / 전자기기</label>
                      </div>
                    </div>

                    <div class="box">
                        <div class="info">
                          <h2>UPLOAD INFO</h2>
                          <p>공개여부: {% if edit_mode %}전체공개{% else %}미공개{% endif %}</p>
                        </div>
                        <a href="" onclick="openPopup()">임시저장 리스트</a>
                        <div class="save-box">
                            <button type="submit" class="temp-save-button" name='temp-save-button'>임시저장</button>
                            <button type="submit" class="save-button">글 작성</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>   
    </main>

    <footer class="footer">
        <div class="container">
            <p>Made by<span> Dojo</span></p>

        </div>
    </footer>

</body>
<script>
    document.getElementById('aiAutocompleteButton').addEventListener('click', function() {
        // 로딩 애니메이션 
        document.getElementById('loading-animation').style.display = 'block';
        document.getElementById('ai-img').style.display = 'none';

        let title = document.getElementById('title').value;
        var editorInstanceName = 'id_content'
        fetch('/autocomplete/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': '{{ csrf_token }}',
          },
          body: new URLSearchParams({
            'title': title
          })
        })
        .then(response => response.json())
        .then(data => {
          document.getElementById('loading-animation').style.display = 'none';
          document.getElementById('ai-img').style.display = 'block';
      
          //기존 내용에 자동완성 된 내용 더함
          let currentdata = CKEDITOR.instances['id_content'].getData();
        data_message = data.message.replace(/<br\s*[\/]?>/gi, '\n');
        CKEDITOR.instances['id_content'].setData(currentdata + data_message);
        })
        .catch(error => {
          console.error('Error:', error);
          document.getElementById('loading-animation').style.display = 'none';
        });
      });


    function openPopup() {
        var popup = window.open("{% url 'blogapp:popup' %}", "Popup", "width=400,height=400");
    }
</script>
</html>